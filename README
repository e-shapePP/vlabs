Main code is in the 
